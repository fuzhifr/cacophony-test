<!DOCTYPE html>
<html>
<head>
<title>Cacophony Demo</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript" src="build/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="build/jquery-ui-1.8.6.custom.min.js"></script>
<script type="text/javascript" src="build/cacophony.min.js"></script>
<script type="text/javascript" src="js/settings.js"></script>
<script type="text/javascript" src="js/loadJS.js"></script>
<script id="storyJS" type="text/javascript" src=""></script>
<link rel="stylesheet" type="text/css" href="build/cacophony.min.css" />
</head>
<body>
<script type="text/javascript">
function GetRequest() {
   var url = location.search; //获取url中"?"符后的字串
   var theRequest = new Object();
   if (url.indexOf("?") != -1) {
	  var str = url.substr(1);
	  strs = str.split("&");
	  for(var i = 0; i < strs.length; i ++) {
		 theRequest[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1]);
	  }
   }
   return theRequest;
}

	var Request = new Object();
	Request = GetRequest();
	var realname=Request['realname'];
	var storyFile='js/StoryFile/story'+realname+'.js';
	

$(document).ready (function () {
    // chaque fois, on regarde le fichier buttoninfo pour créer les buttons automatiquement
	var urlJSON='js/StoryFile/buttonInfo_'+realname+'.json';
	$.getJSON(urlJSON,function(data){
		console.log(data);
		$.each(data,function(i,item){
			var buttonHtml="";
			for(var j=0;j<item.length;j++){
			buttonHtml+="<button onclick='jumpTo("+item[j].jumpTo+")'>"
			buttonHtml+=item[j].label+"</button> <p>";
			}
			$("#buttonList").html(buttonHtml);
		});
	});
	// Specify the video files. Multiple files are required to be compatible
	// with the different browsers at this time.
	loadJS('storyJS',storyFile);
	cacophony.setVideo (
		'server/php/files/'+realname+'.mp4',
		'server/php/files/'+realname+'.webm',
		'server/php/files/'+realname+'.ogv'
	);

	cacophony.init ();
	cacophony.play();

});

function jumpTo(time){
    if(cacophony.beat+1<time){
		alert("Vous devez avoir visité cette partie!")
	}else{
		cacophony.jumpToTime(time);
	}
}
</script>

<style type="text/css">

.content{
    margin:0 auto;
	overflow:hidden;
}
.leftDiv {
	float:left; 
	margin-left:10%;
}
.rightDiv{
	float:left; 
	margin-left:30px;
	margin-top:5%;
	width:20%;
} 
</style>
<div class="content">	
	<div class="leftDiv">
	<div id="cacophony" ></div>
	</div>
	<div id="buttonList" class="rightDiv">
	</div>
</div>
</body>
</html>